<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>CyberOffz: Trainer & Pr√ºfung</title>
<style>
:root {
  --bg: #0f172a; --panel: #1e293b; --text: #f1f5f9; --muted: #94a3b8;
  --accent: #3b82f6; --success: #22c55e; --error: #ef4444; --border: rgba(255,255,255,0.1);
  --warning: #f59e0b;
}
body { margin:0; font-family:'Segoe UI', Roboto, sans-serif; background:var(--bg); color:var(--text); height:100vh; display:flex; flex-direction:column; overflow:hidden; }

/* UTILS */
.wrap { width:100%; max-width:850px; margin:0 auto; padding:20px; flex:1; display:flex; flex-direction:column; position:relative; }
.scroll-wrap { overflow-y:auto; flex:1; padding-bottom:40px; }
.hidden { display:none !important; }
.btn { border:none; padding:12px 20px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:1rem; color:white; transition:0.2s; display:inline-flex; align-items:center; justify-content:center; gap:8px; }
.btn:hover { filter:brightness(1.1); }
.btn-primary { background:var(--accent); }
.btn-exam { background:var(--warning); color:#000; }
.btn-outline { background:transparent; border:1px solid var(--border); color:var(--muted); }
.btn-outline:hover { border-color:var(--text); color:var(--text); }
h1, h2, h3 { margin:0 0 10px 0; }

/* START SCREEN */
#start-screen { text-align:center; justify-content:center; }
.mode-card { background:var(--panel); border:1px solid var(--border); padding:20px; border-radius:12px; margin-bottom:15px; text-align:left; cursor:pointer; transition:0.2s; display:flex; justify-content:space-between; align-items:center; }
.mode-card:hover { border-color:var(--accent); background:rgba(255,255,255,0.03); }
.tag { font-size:0.75rem; padding:2px 8px; border-radius:4px; background:rgba(255,255,255,0.1); font-weight:bold; }

/* TRAINER MODE (FLASHCARD) */
.top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; font-size:0.9rem; color:var(--muted); }
.streak-box { color:var(--accent); font-weight:bold; }
.progress-track { height:6px; background:rgba(255,255,255,0.1); border-radius:3px; overflow:hidden; margin-bottom:20px; }
.progress-fill { height:100%; background:var(--accent); width:0%; transition:width 0.3s; }
.card { background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:30px; display:flex; flex-direction:column; gap:20px; box-shadow:0 10px 30px rgba(0,0,0,0.3); }
.q-meta { font-size:12px; text-transform:uppercase; letter-spacing:1px; color:var(--muted); font-weight:bold; }
.q-text { font-size:1.4rem; line-height:1.4; font-weight:600; }
.opt-grid { display:grid; gap:10px; }
.opt-btn { background:rgba(255,255,255,0.05); border:1px solid var(--border); padding:15px; border-radius:10px; color:var(--text); text-align:left; cursor:pointer; transition:0.1s; display:flex; align-items:center; }
.opt-btn:hover:not(.disabled) { background:rgba(255,255,255,0.1); border-color:var(--accent); }
.opt-key { background:rgba(0,0,0,0.3); width:24px; height:24px; display:flex; align-items:center; justify-content:center; border-radius:4px; margin-right:12px; font-size:0.8rem; font-family:monospace; border:1px solid var(--border); color:var(--muted); }
.opt-btn.correct { background:rgba(34,197,94,0.15); border-color:var(--success); color:var(--success); }
.opt-btn.wrong { background:rgba(239,68,68,0.15); border-color:var(--error); color:var(--error); opacity:0.6; }
.opt-btn.disabled { pointer-events:none; }

/* EXPLANATION BOX (TRAINER) */
.expl-box { padding:15px; border-radius:8px; margin-top:0px; display:none; animation:fadeIn 0.3s; font-size:0.95rem; line-height:1.5; border-left:4px solid transparent; }
.expl-box.is-correct { background:rgba(34,197,94,0.1); border-left-color:var(--success); }
.expl-box.is-wrong { background:rgba(239,68,68,0.1); border-left-color:var(--error); }
.expl-title { font-weight:bold; margin-bottom:5px; display:block; }

/* EXAM MODE (LIST) */
.exam-item { background:var(--panel); padding:20px; border-radius:12px; border:1px solid var(--border); margin-bottom:15px; }
.exam-q { font-size:1.1rem; font-weight:600; margin-bottom:15px; }
.exam-opt { display:flex; align-items:start; gap:10px; padding:8px 0; cursor:pointer; }
.exam-opt input { margin-top:5px; transform:scale(1.2); }
.exam-expl { margin-top:15px; padding-top:15px; border-top:1px solid var(--border); color:var(--muted); font-size:0.9rem; display:none; }
.exam-item.graded-correct { border-color:var(--success); }
.exam-item.graded-wrong { border-color:var(--error); }
.exam-item.graded-correct .exam-expl, .exam-item.graded-wrong .exam-expl { display:block; }
.exam-score-box { background:var(--panel); padding:20px; border-radius:12px; margin-bottom:20px; text-align:center; border:1px solid var(--border); }

/* ANIMATIONS */
@keyframes fadeIn { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }
</style>
</head>
<body>

<div id="start-screen" class="wrap scroll-wrap">
    <div style="margin:40px 0;">
        <h1>CyberOffz Lernportal</h1>
        <p style="color:var(--muted)">W√§hle deinen Modus.</p>
    </div>

    <div class="mode-card" onclick="initTrainer('ALL')">
        <div>
            <h3>üöÄ Speed-Trainer (Alle Fragen)</h3>
            <div style="color:var(--muted); font-size:0.9rem;">Karteikarten ‚Ä¢ Sofort-Feedback ‚Ä¢ Erkl√§rungen</div>
        </div>
        <div class="tag" style="background:var(--accent)">LERNEN</div>
    </div>

    <div class="mode-card" onclick="initExam()">
        <div>
            <h3>üìù Pr√ºfungsmodus (45 Fragen)</h3>
            <div style="color:var(--muted); font-size:0.9rem;">Listenansicht ‚Ä¢ Keine Tipps ‚Ä¢ Auswertung am Ende</div>
        </div>
        <div class="tag" style="background:var(--warning); color:#000;">TEST</div>
    </div>

    <h3 style="margin-top:30px; border-bottom:1px solid var(--border); padding-bottom:10px;">Themen-Fokus (Trainer)</h3>
    <div id="module-list" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
</div>

<div id="trainer-screen" class="wrap hidden">
    <div class="top-bar">
        <button class="btn btn-outline" style="padding:4px 10px; font-size:0.8rem;" onclick="location.reload()">Beenden</button>
        <div class="streak-box">üî• Streak: <span id="t-streak">0</span></div>
    </div>
    <div class="progress-track"><div id="t-progress" class="progress-fill"></div></div>
    
    <div class="card">
        <div class="q-meta">
            <span id="t-mod">MODUL</span> ‚Ä¢ <span id="t-idx">1/10</span>
            <span id="t-retry-badge" class="hidden" style="color:var(--error); margin-left:10px;">‚ö† WIEDERHOLUNG</span>
        </div>
        <div class="q-text" id="t-question">Frage l√§dt...</div>
        <div class="opt-grid" id="t-options"></div>
        
        <div id="t-expl" class="expl-box">
            <span class="expl-title" id="t-expl-title"></span>
            <span id="t-expl-text"></span>
        </div>
    </div>
    
    <div style="text-align:center; margin-top:20px; color:var(--muted); font-size:0.8rem;">
        <span style="background:rgba(255,255,255,0.1); padding:2px 6px; border-radius:4px;">1-4</span> Antwort ‚Ä¢ 
        <span style="background:rgba(255,255,255,0.1); padding:2px 6px; border-radius:4px;">Leertaste</span> Weiter
    </div>
</div>

<div id="exam-screen" class="wrap hidden scroll-wrap">
    <div class="top-bar">
        <button class="btn btn-outline" onclick="if(confirm('Pr√ºfung abbrechen?')) location.reload()">Abbrechen</button>
        <div>Pr√ºfungssimulation</div>
    </div>

    <div id="exam-result-header" class="hidden"></div>
    <div id="exam-list"></div>
    
    <div style="margin-top:20px; padding-top:20px; border-top:1px solid var(--border);">
        <button id="btn-submit-exam" class="btn btn-primary" style="width:100%;" onclick="submitExam()">Pr√ºfung abgeben</button>
    </div>
</div>

<script>
/* --- DATENBANK MIT ERKL√ÑRUNGEN --- */
const BANK = [
    // GRUNDLAGEN
    { q: "Welches Schutzziel wird verletzt, wenn ein Angreifer eine Webseite so √ºberlastet, dass sie nicht mehr erreichbar ist?", a: "Verf√ºgbarkeit", e: "Wenn Dienste oder Daten nicht wie vorgesehen abgerufen werden k√∂nnen (z.B. durch DDoS), ist die Verf√ºgbarkeit beeintr√§chtigt.", o: ["Vertraulichkeit", "Verf√ºgbarkeit", "Integrit√§t", "Authentizit√§t"], m: "GRUNDLAGEN" },
    { q: "Was beschreibt die 'Integrit√§t' von Informationen?", a: "Dass Daten nicht unbefugt oder unbemerkt ver√§ndert werden k√∂nnen.", e: "Integrit√§t stellt sicher, dass Daten vollst√§ndig und unver√§ndert bleiben. (Schutz vor Manipulation).", o: ["Dass Daten nur f√ºr Berechtigte lesbar sind", "Dass Daten jederzeit abrufbar sind", "Dass Daten nicht unbefugt oder unbemerkt ver√§ndert werden k√∂nnen.", "Dass der Absender eindeutig identifizierbar ist"], m: "GRUNDLAGEN" },
    { q: "Was ist ein 'SSI' (Security Significant Item)?", a: "Sicherheitsempfindliche Gegenst√§nde oder Komponenten.", e: "SSIs sind Komponenten in Waffensystemen oder IT, die sicherheitsrelevant sind und besonderen Schutz bed√ºrfen.", o: ["Software-Security-Interface", "Sicherheitsempfindliche Gegenst√§nde oder Komponenten.", "Sicherheits-Service-Instanz", "System-Sicherheits-Index"], m: "GRUNDLAGEN" },
    { q: "Welche Einstufung ist h√∂her: VS-GEHEIM oder VS-VERTRAULICH?", a: "VS-GEHEIM", e: "Die Reihenfolge ist: VS-NfD < VS-VERTRAULICH < VS-GEHEIM < STRENG GEHEIM.", o: ["VS-NfD", "VS-VERTRAULICH", "VS-GEHEIM", "Beide sind gleich"], m: "GRUNDLAGEN" },
    { q: "Wie lautet die Kernformel f√ºr die Informationssicherheit?", a: "Gef√§hrdung = Bedrohung + Schwachstelle", e: "Eine Gef√§hrdung entsteht erst, wenn eine Bedrohung auf eine vorhandene Schwachstelle trifft.", o: ["Risiko = Hacker x Zeit", "Gef√§hrdung = Bedrohung + Schwachstelle", "Sicherheit = Firewall + Antivirus", "Schutz = Passwort + Verschl√ºsselung"], m: "GRUNDLAGEN" },
    { q: "Wer tr√§gt die Gesamtverantwortung f√ºr die Informationssicherheit in einer Dienststelle?", a: "Der Dienststellenleiter", e: "Die Verantwortung f√ºr Sicherheit ist unteilbar und liegt immer bei der F√ºhrung (DStL). Der ISB ber√§t nur.", o: ["Der IT-Offizier", "Der ISB", "Der Dienststellenleiter", "Der Kryptoverwalter"], m: "GRUNDLAGEN" },

    // BEDROHUNGEN
    { q: "Welche Phase der Cyber Kill Chain beschreibt das Ausnutzen einer Sicherheitsl√ºcke auf dem Zielsystem?", a: "Exploitation", e: "In der Phase 'Exploitation' wird der Schadcode ausgef√ºhrt, um eine Schwachstelle auszunutzen.", o: ["Weaponization", "Delivery", "Exploitation", "Installation"], m: "BEDROHUNGEN" },
    { q: "In der 'Pyramid of Pain' sind Hash-Werte f√ºr Angreifer leicht zu √§ndern. Welches Element ist am schwierigsten zu √§ndern?", a: "TTPs (Tactics, Techniques & Procedures)", e: "TTPs beschreiben das Verhalten des Angreifers. Dieses zu √§ndern erfordert Umlernen und neue Entwicklung, was sehr 'schmerzhaft' f√ºr den Angreifer ist.", o: ["IP-Adressen", "Domainnamen", "Werkzeuge", "TTPs (Tactics, Techniques & Procedures)"], m: "BEDROHUNGEN" },
    { q: "Welcher Bedrohungsakteur wird oft mit Russland in Verbindung gebracht und griff u.a. den Deutschen Bundestag an?", a: "APT 28 (Fancy Bear)", e: "APT 28 (Sofacy/Fancy Bear) wird dem russischen Milit√§rgeheimdienst GRU zugeordnet.", o: ["APT 10", "APT 28 (Fancy Bear)", "APT 38", "APT 1"], m: "BEDROHUNGEN" },
    { q: "Was ist das Hauptmerkmal eines 'APT' (Advanced Persistent Threat)?", a: "Langanhaltende, zielgerichtete und hochkomplexe Angriffe.", e: "Im Gegensatz zu opportunistischen Angriffen setzen APTs auf langfristigen Verbleib im Netz und spezifische Ziele.", o: ["Ein automatisierter Virenscan", "Ein kurzer, zuf√§lliger Angriff", "Langanhaltende, zielgerichtete und hochkomplexe Angriffe.", "Ein Angriff durch gelangweilte Jugendliche"], m: "BEDROHUNGEN" },
    { q: "Welche APT-Gruppe ist bekannt f√ºr Finanzraub und Angriffe auf das SWIFT-System (Nordkorea)?", a: "APT 38 (Lazarus Group)", e: "APT 38 agiert im Auftrag Nordkoreas prim√§r zur Devisenbeschaffung (Bank√ºberf√§lle, Krypto-Diebstahl).", o: ["APT 29", "APT 10", "APT 38 (Lazarus Group)", "APT 44"], m: "BEDROHUNGEN" },
    { q: "Was beschreibt 'Lateral Movement'?", a: "Das Ausbreiten des Angreifers innerhalb des Netzwerks von System zu System.", e: "Nach dem Einbruch bewegt sich der Angreifer seitw√§rts zu anderen Servern, um das eigentliche Ziel (z.B. Domain Controller) zu erreichen.", o: ["Das Herunterladen von Daten", "Das L√∂schen von Log-Dateien", "Das Ausbreiten des Angreifers innerhalb des Netzwerks von System zu System.", "Die erste Infektion per E-Mail"], m: "BEDROHUNGEN" },
    { q: "Was beschreibt die 'Reconnaissance' in der Cyber Kill Chain?", a: "Das Sammeln von Informationen √ºber das Ziel.", e: "Die Aufkl√§rung (Recon) ist der erste Schritt: Ziele ausw√§hlen, E-Mail-Adressen sammeln, Infrastruktur scannen.", o: ["Das Erstellen von Exploits", "Das Sammeln von Informationen √ºber das Ziel.", "Das Installieren einer Backdoor", "Den Abfluss von Daten"], m: "BEDROHUNGEN" },
    { q: "Welches Framework bietet eine Wissensdatenbank f√ºr Taktiken und Techniken von Angreifern basierend auf Realwelt-Beobachtungen?", a: "MITRE ATT&CK", e: "MITRE ATT&CK ist der weltweite Standard zur Klassifizierung von Angreiferverhalten (TTPs).", o: ["Cyber Kill Chain", "Diamond Model", "MITRE ATT&CK", "ISO 27001"], m: "BEDROHUNGEN" },
    
    // SCHUTZKONZEPTE
    { q: "Was beschreibt die 'Organisation' im OPTI-Modell?", a: "Regelungen, Konzepte und Richtlinien.", e: "Organisation umfasst Dienstvorschriften, Befehle, Konzepte und Prozesse. Personal, Technik und Infrastruktur sind die anderen S√§ulen.", o: ["Bauliche Ma√ünahmen", "Regelungen, Konzepte und Richtlinien.", "Firewalls und Verschl√ºsselung", "√úberpr√ºfung von Mitarbeitern"], m: "SCHUTZKONZEPTE" },
    { q: "Was ist eine 'WAF' (Web Application Firewall)?", a: "Eine Firewall, die speziell den HTTP/HTTPS-Verkehr auf Anwendungsebene filtert.", e: "Im Gegensatz zu normalen Firewalls (Layer 3/4) pr√ºft die WAF Inhalte auf Angriffe wie SQL-Injection oder XSS (Layer 7).", o: ["Ein Schutz gegen WLAN-Hacker", "Ein Hardware-Schutz f√ºr Serverr√§ume", "Eine Firewall, die speziell den HTTP/HTTPS-Verkehr auf Anwendungsebene filtert.", "Ein Tool zur Passwortverwaltung"], m: "SCHUTZKONZEPTE" },
    { q: "Wof√ºr steht 'SIEM'?", a: "Security Information and Event Management", e: "SIEM-Systeme sammeln Logs aus verschiedenen Quellen, korrelieren diese und alarmieren bei Sicherheitsvorf√§llen.", o: ["System Information and Electronic Mail", "Security Information and Event Management", "Secure Internal Encryption Mode", "Software Interface for Electronic Monitoring"], m: "SCHUTZKONZEPTE" },
    { q: "Was ist ein 'Honey Pot'?", a: "Ein K√∂dersystem, das Angreifer anlocken und deren Verhalten analysieren soll.", e: "Honeypots simulieren verwundbare Dienste. Da kein normaler User sie nutzt, ist jeder Zugriff darauf verd√§chtig.", o: ["Ein sehr sicheres Passwort", "Ein Backup-Server", "Ein K√∂dersystem, das Angreifer anlocken und deren Verhalten analysieren soll.", "Eine Verschl√ºsselungsmethode"], m: "SCHUTZKONZEPTE" },
    { q: "Was ist der Vorteil von Netzsegmentierung?", a: "Schadsoftware kann sich nicht ungehindert im gesamten Netzwerk ausbreiten.", e: "Durch Segmentierung (VLANs, Firewalls) wird 'Lateral Movement' erschwert. Ein kompromittierter PC gef√§hrdet nicht sofort das Rechenzentrum.", o: ["Das Internet wird schneller", "Die Hardware h√§lt l√§nger", "Schadsoftware kann sich nicht ungehindert im gesamten Netzwerk ausbreiten.", "Man spart Strom"], m: "SCHUTZKONZEPTE" },
    
    // ABSTRAHLUNG
    { q: "Was ist das Ziel der Abstrahlsicherheit?", a: "Verhinderung der Aussp√§hung durch kompromittierende elektromagnetische Strahlung.", e: "Jedes elektronische Ger√§t sendet Strahlung aus. TEMPEST-Ma√ünahmen verhindern, dass diese Strahlung aufgefangen und rekonstruiert wird.", o: ["Schutz vor Blitzeinschl√§gen", "Verhinderung der Aussp√§hung durch kompromittierende elektromagnetische Strahlung.", "K√ºhlung der Server", "Verhinderung von WLAN-St√∂rungen"], m: "ABSTRAHLUNG" },
    { q: "Welche Zone beschreibt einen Bereich, in dem VS nur bearbeitet werden darf, wenn das Ger√§t speziell geschirmt ist?", a: "Zone 2 oder 3", e: "Zone 0 ist kontrolliert (bester Schutz). Zone 2/3 haben kaum Schutzabstand, daher m√ºssen dort abstrahlsichere Ger√§te (SDIP 27 Level A) genutzt werden.", o: ["Zone 0", "Zone 1", "Zone 2 oder 3", "Zone X"], m: "ABSTRAHLUNG" },
    { q: "Was bedeutet 'MEP'?", a: "Mess- und Pr√ºfplakette (f√ºr die Abstrahlpr√ºfung).", e: "Ger√§te mit MEP wurden technisch vermessen und f√ºr den Betrieb in bestimmten Zonen freigegeben.", o: ["Milit√§rische Einzel-Pr√ºfung", "Mess- und Pr√ºfplakette (f√ºr die Abstrahlpr√ºfung).", "Mobile Elektronik-Pr√§vention", "Management-Einstufungs-Protokoll"], m: "ABSTRAHLUNG" },
    { q: "In welchen Abst√§nden muss eine Wiederholungsmessung f√ºr mobile IT-Systeme (MEP) erfolgen?", a: "Sp√§testens nach 12 Monaten.", e: "Aufgrund mechanischer Belastung bei mobilen Ger√§ten muss die Schirmung j√§hrlich gepr√ºft werden.", o: ["Alle 6 Monate", "Sp√§testens nach 12 Monaten.", "Alle 24 Monate", "Nur bei Defekt"], m: "ABSTRAHLUNG" },
    { q: "In welchem Dokument der Bundeswehr ist die Abstrahlsicherheit prim√§r geregelt?", a: "A-960/1", e: "Die A-960/1 regelt die Abstrahlsicherheit in der Bundeswehr.", o: ["A-960/1", "ZDv 3/12", "IT-Grundschutz", "Bw-Krypto-Handbuch"], m: "ABSTRAHLUNG" },

    // KRYPTO
    { q: "Wo befindet sich die NDA (National Distribution Agency) der Bundeswehr?", a: "Rheinbach", e: "Das IT-Zentrum Bw in Rheinbach fungiert als zentrale NDA f√ºr Deutschland.", o: ["Bonn", "Berlin", "Rheinbach", "M√ºnchen"], m: "KRYPTO" },
    { q: "Welches Krypto-ATZ ist f√ºr den Bereich NORD zust√§ndig?", a: "Wilhelmshaven (Kryptozentrum Marine)", e: "Es gibt 4 ATZ. Wilhelmshaven deckt den Norden ab.", o: ["Kiel", "Rostock", "Wilhelmshaven (Kryptozentrum Marine)", "Oldenburg"], m: "KRYPTO" },
    { q: "Wer darf die Vernichtung von Kryptomitteln durchf√ºhren?", a: "Der Kryptoverwalter in Anwesenheit eines Zeugen.", e: "Vier-Augen-Prinzip ist zwingend erforderlich. Ein Protokoll muss erstellt werden.", o: ["Jeder Soldat", "Nur der IT-Offizier", "Der Kryptoverwalter in Anwesenheit eines Zeugen.", "Nur externes Fachpersonal"], m: "KRYPTO" },
    { q: "Welches Papier-Vernichtungsverfahren ist bei Kryptomitteln NICHT zul√§ssig?", a: "Einfacher Streifenschnitt breiter als 1mm.", e: "Kryptomittel erfordern hohe Sicherheitsstufen (Partikelschnitt/Kreuzschnitt), da Streifen rekonstruierbar sind.", o: ["Verbrennen", "Verfl√ºssigen", "Einfacher Streifenschnitt breiter als 1mm.", "Kreuzschnitt (Partikelgr√∂√üe max. 0,5x1,5mm)"], m: "KRYPTO" },
    { q: "In welcher Situation ist eine 'Notvernichtung' einzuleiten?", a: "Bei unmittelbar drohendem Zugriff durch Unbefugte oder den Feind.", e: "Ziel ist es, dem Feind den Zugriff auf Schl√ºsselmaterial zu verwehren (z.B. bei √úberrrennung des Gefechtsstands).", o: ["Wenn der Schrank voll ist", "Bei unmittelbar drohendem Zugriff durch Unbefugte oder den Feind.", "Wenn das Haltbarkeitsdatum abgelaufen ist", "Bei einem normalen Software-Update"], m: "KRYPTO" },
    { q: "Wie m√ºssen Sonderkurier und Kurierbegleiter im Flugzeug sitzen?", a: "Sie m√ºssen zusammen sitzen und d√ºrfen nicht vom Kuriergep√§ck getrennt werden.", e: "Das Material darf niemals unbeaufsichtigt sein. Trennung (z.B. Gep√§ck im Frachtraum) ist verboten.", o: ["Getrennt voneinander (Sicherheit)", "In verschiedenen Klassen", "Sie m√ºssen zusammen sitzen und d√ºrfen nicht vom Kuriergep√§ck getrennt werden.", "Einer sitzt beim Gep√§ck im Frachtraum"], m: "KRYPTO" },
    { q: "Welches kryptographische Verfahren gilt heute als unsicher (geknackt)?", a: "DES", e: "Der Data Encryption Standard (56 Bit) ist aufgrund der geringen Schl√ºssell√§nge heute in Sekunden knackbar.", o: ["AES", "DES", "RSA", "ECC"], m: "KRYPTO" },
    { q: "Was ist das Hauptmerkmal einer 'Stromchiffre'?", a: "Die Nachricht wird bitweise oder zeichenweise verschl√ºsselt.", e: "Im Gegensatz zur Blockchiffre (die Bl√∂cke verschl√ºsselt) wird hier ein endloser Schl√ºsselstrom mit den Daten XOR-verkn√ºpft.", o: ["Die Verschl√ºsselung ben√∂tigt viel Strom", "Die Nachricht wird in gro√üen Bl√∂cken (z.B. 128 Bit) verschl√ºsselt", "Die Nachricht wird bitweise oder zeichenweise verschl√ºsselt.", "Die Verschl√ºsselung funktioniert nur online"], m: "KRYPTO" },
    { q: "Wie viele Personen m√ºssen beim Transport von Kryptovariablen (Schl√ºsseln) anwesend sein?", a: "Zwei (Sonderkurier und Kurierbegleiter).", e: "Schl√ºsseltransport erfordert zwingend zwei Personen (Vier-Augen-Prinzip) zum Schutz vor Manipulation oder Verlust.", o: ["Eine Person reicht", "Zwei (Sonderkurier und Kurierbegleiter).", "Drei Personen", "Immer ein ganzer Zug"], m: "KRYPTO" },
    
    // NEUE FRAGEN (GEMISCHT)
    { q: "Was ist ein 'IOC' (Indicator of Compromise)?", a: "Ein technisches Merkmal (z.B. Hash, IP), das auf eine Infektion hinweist.", e: "IOCs sind Spuren, die Angreifer hinterlassen (Dateinamen, MD5-Hashes, C2-Server-IPs).", o: ["Ein Zertifikat f√ºr sichere Software", "Ein technisches Merkmal (z.B. Hash, IP), das auf eine Infektion hinweist.", "Ein spezieller Dienstgrad im CIR", "Eine Methode zur Passwort-Verschl√ºsselung"], m: "BEDROHUNGEN" },
    { q: "Was f√§llt unter die S√§ule 'Infrastruktur' (PIMO)?", a: "Zutrittskontrollsysteme, Z√§une und Tresore.", e: "Infrastruktur betrifft die physische Sicherheit. IT-Hardware geh√∂rt meist zur S√§ule 'Technik/Material' oder Infrastruktur je nach Definition.", o: ["Virenscanner", "Dienstanweisungen", "Zutrittskontrollsysteme, Z√§une und Tresore.", "Firewall-Regeln"], m: "SCHUTZKONZEPTE" },
    { q: "Was ist 'Defense in Depth'?", a: "Ein mehrschichtiges Sicherheitskonzept (gestaffelte Verteidigung).", e: "Wenn eine Ma√ünahme versagt (z.B. Firewall), greift die n√§chste (z.B. AV oder Verschl√ºsselung). Zwiebelschalenprinzip.", o: ["Das Vergraben von Servern im Boden", "Ein mehrschichtiges Sicherheitskonzept (gestaffelte Verteidigung).", "Die Verteidigung der Au√üengrenzen", "Verschl√ºsselung mit sehr langen Schl√ºsseln"], m: "SCHUTZKONZEPTE" },
    { q: "Welches System dient der Filterung von ausgehendem Webverkehr f√ºr interne Nutzer?", a: "Forward Proxy", e: "Ein Forward Proxy steht vor den Clients und kontrolliert deren Zugriff ins Internet.", o: ["Reverse Proxy", "Forward Proxy", "WAF", "Honey Pot"], m: "SCHUTZKONZEPTE" },
    { q: "Welches Verfahren nutzt RSA prim√§r?", a: "Asymmetrische Verschl√ºsselung (Primfaktorzerlegung).", e: "RSA basiert auf der mathematischen Schwierigkeit, gro√üe Zahlen in ihre Primfaktoren zu zerlegen.", o: ["Symmetrische Verschl√ºsselung", "Asymmetrische Verschl√ºsselung (Primfaktorzerlegung).", "Hashing", "Stromchiffrierung"], m: "KRYPTO" },
    { q: "Welche Beh√∂rde ist in Deutschland f√ºr die Zulassung von IT-Sicherheitsprodukten f√ºr VS zust√§ndig?", a: "BSI (Bundesamt f√ºr Sicherheit in der Informationstechnik).", e: "Das BSI pr√ºft und zertifiziert Produkte f√ºr den Einsatz mit Verschlusssachen.", o: ["BMVg", "BSI (Bundesamt f√ºr Sicherheit in der Informationstechnik).", "MAD", "BND"], m: "KRYPTO" },
    { q: "Was bedeutet 'Offline-Kryptierung'?", a: "Verschl√ºsselung der Daten vor der √úbertragung (nicht im Stream).", e: "Daten werden erst verschl√ºsselt, gespeichert und dann als Datei versendet (z.B. E-Mail-Verschl√ºsselung S/MIME), anders als Link-Encryption.", o: ["Verschl√ºsselung ohne Strom", "Verschl√ºsselung der Daten vor der √úbertragung (nicht im Stream).", "Verschl√ºsselung in einem Funkger√§t", "L√∂schen von Daten"], m: "KRYPTO" },
    { q: "Wer unterst√ºtzt den Dienststellenleiter fachlich bei der Umsetzung der Informationssicherheit?", a: "Der Informationssicherheitsbeauftragte (ISB).", e: "Der ISB ist der direkte Berater der F√ºhrung und koordiniert den Sicherheitsprozess.", o: ["Der S6-Offizier", "Der IT-Administrator", "Der Informationssicherheitsbeauftragte (ISB).", "Der Spie√ü"], m: "PERSONAL" },
    { q: "Was ist 'Social Engineering'?", a: "Die Manipulation von Menschen, um an geheime Informationen zu gelangen.", e: "Der Faktor Mensch wird ausgenutzt (z.B. Hilfsbereitschaft oder Autorit√§tsh√∂rigkeit), um Technik zu umgehen.", o: ["Das Programmieren von sozialen Netzwerken", "Die Manipulation von Menschen, um an geheime Informationen zu gelangen.", "Ein spezieller Ingenieurstudiengang", "Das Hacken von Datenbanken"], m: "BEDROHUNGEN" },
    { q: "Welches Dokument muss jeder unterschreiben, der mit VS arbeitet?", a: "Sicherheitsbelehrung / Verpflichtung auf den Geheimschutz.", e: "Ohne formale Belehrung und Verpflichtung ist kein Zugang zu VS zul√§ssig.", o: ["Mietvertrag", "Sicherheitsbelehrung / Verpflichtung auf den Geheimschutz.", "Urlaubsantrag", "Waffenschein"], m: "GRUNDLAGEN" },
    { q: "Was ist ein wesentlicher Vorteil von Bedrohungsmodellierung?", a: "Einblicke in das Verhalten von Angreifern zu erhalten", e: "Modelle wie ATT&CK helfen, Verteidigung nicht nur auf Technik, sondern auf T√§terverhalten auszurichten.", o: ["Einblicke in das Verhalten von Angreifern zu erhalten", "Vollst√§ndige Automatisierung der Abwehr", "Einsparung von IT-Personal", "Ersatz f√ºr physische Sicherheitsma√ünahmen"], m: "BEDROHUNGEN" },
    { q: "TTPs (Tactics, Techniques & Procedures) sind sehr best√§ndig und k√∂nnen deswegen leichter automatisiert erkannt werden. Ist diese Aussage korrekt?", a: "Nein, das ist falsch.", e: "TTPs sind schwer zu erkennen, da sie oft legitime Tools (PowerShell) nutzen. Hashwerte (Tools) sind leicht zu erkennen, TTPs erfordern Verhaltensanalyse.", o: ["Ja, das ist richtig.", "Nein, das ist falsch.", "Nur bei privatem WLAN.", "Nur bei Hardware-Angriffen."], m: "BEDROHUNGEN" },
    { q: "Living-off-the-Land (LotL) Techniken erschweren die Erkennung, da sie √ºbliche, bereits vorhandene Software verwenden. Ist das korrekt?", a: "Ja, das ist richtig.", e: "Angreifer nutzen bordeigene Mittel (cmd.exe, PowerShell, WMI), um von Virenscannern nicht entdeckt zu werden.", o: ["Ja, das ist richtig.", "Nein, das ist falsch.", "LotL bezieht sich nur auf Hardware-Diebstahl.", "LotL wird nur von Einzelt√§tern genutzt."], m: "BEDROHUNGEN" },
    { q: "Liegt der prim√§re Fokus bei MITRE ATT&CK auf IOCs (Indicators of Compromise)?", a: "Nein, das ist falsch.", e: "Der Fokus liegt auf TTPs (Verhalten). IOCs sind Teil der 'Pyramid of Pain' weiter unten.", o: ["Ja, das ist richtig.", "Nein, das ist falsch.", "Nur bei Ransomware-Angriffen.", "Nur f√ºr VS-NfD eingestufte Netze."], m: "BEDROHUNGEN" },
    { q: "Ein Virus ist ein selbstreplizierender Code, der kein Wirtsprogramm ben√∂tigt. Korrekt?", a: "Falsch, ein Wurm ben√∂tigt kein Wirtsprogramm.", e: "Ein Virus braucht einen Wirt (Datei). Ein Wurm verbreitet sich eigenst√§ndig √ºber das Netzwerk.", o: ["Richtig.", "Falsch, ein Trojaner ben√∂tigt kein Wirtsprogramm.", "Falsch, ein Wurm ben√∂tigt kein Wirtsprogramm.", "Falsch, Malware ben√∂tigt immer Internet."], m: "BEDROHUNGEN" },
    { q: "Als seri√∂se Sicherheitssoftware getarnte Schadsoftware bezeichnet man als...", a: "Rougeware", e: "Scareware oder Rogueware behauptet, der PC sei infiziert, um Geld f√ºr die 'Bereinigung' zu erpressen.", o: ["Spyware", "Rougeware", "Adware", "Firmware"], m: "BEDROHUNGEN" },
    { q: "Was bezeichnet KEIN typisches Einfallstor f√ºr Ransomware?", a: "MFA (Mehrfaktorauthentifizierung)", e: "MFA ist eine Schutzma√ünahme. Typische Einfallstore sind Phishing, RDP und ungepatchte Systeme.", o: ["Phishing-E-Mails", "MFA (Mehrfaktorauthentifizierung)", "RDP-Schwachstellen", "Ungepatchte VPN-Server"], m: "BEDROHUNGEN" },
    { q: "Was versteht man unter 'Vishing'?", a: "Phishing per Telefonanruf", e: "Voice Phishing. Der Angreifer ruft an und gibt sich z.B. als Microsoft-Support aus.", o: ["Phishing per Video-Stream", "Phishing per Telefonanruf", "Verschl√ºsselung von Festplatten", "Abfangen von Funksignalen"], m: "BEDROHUNGEN" },
    { q: "Was beschreibt KEINE Quelle f√ºr OSINT (Open Source Intelligence)?", a: "Intranet der Bundeswehr", e: "Das Intranet ist nicht √∂ffentlich (Open Source), sondern ein geschlossenes Netzwerk.", o: ["Soziale Medien", "Zeitungsartikel", "√ñffentliche Datenbanken", "Intranet der Bundeswehr"], m: "BEDROHUNGEN" },
    { q: "Beim 'Credential Stuffing' werden h√§ufig genutzte Passw√∂rter (z.B. 'Passwort123') bei vielen verschiedenen Accounts getestet. Korrekt?", a: "Nein, das ist falsch (das w√§re Password Spraying).", e: "Credential Stuffing nutzt gestohlene User/Passwort-Paare aus anderen Leaks. Password Spraying testet EIN Passwort gegen VIELE Accounts.", o: ["Ja, das ist richtig.", "Nein, das ist falsch (das w√§re Password Spraying).", "Nein, das w√§re Social Engineering.", "Ja, das ist das Standardvorgehen bei Brute Force."], m: "BEDROHUNGEN" },
    { q: "Was unterscheidet Spear-Phishing von regul√§rem Phishing?", a: "Es handelt sich um einen gezielten Angriff auf eine bestimmte Person oder Organisation.", e: "Phishing ist wie ein Schleppnetz (Masse). Spear-Phishing ist die Harpune (gezieltes Opfer).", o: ["Es wird nur √ºber SMS verschickt.", "Es handelt sich um einen gezielten Angriff auf eine bestimmte Person oder Organisation.", "Es wird nur von staatlichen Akteuren genutzt.", "Es ist technisch nicht nachweisbar."], m: "BEDROHUNGEN" },
    { q: "Welches Ziel verfolgt SEO-Poisoning?", a: "Umleiten von Nutzern √ºber Suchmaschinen auf sch√§dliche Seiten.", e: "Angreifer optimieren manipulierte Webseiten, damit sie bei Google ganz oben erscheinen und Opfer anlocken.", o: ["Das L√∂schen von Google-Eintr√§gen.", "Umleiten von Nutzern √ºber Suchmaschinen auf sch√§dliche Seiten.", "Das Hacken von Datenbanken √ºber SQL-Injections.", "Das Versenden von Spam-Mails."], m: "BEDROHUNGEN" },
    { q: "Welche Ma√ünahme verringert das Risiko von Zero-Day-Exploits NICHT?", a: "Regelm√§√üige Backups", e: "Backups helfen bei der Wiederherstellung NACH dem Angriff, verhindern aber nicht die Ausnutzung der L√ºcke (Exploit).", o: ["Netzsegmentierung", "Sandboxing", "Regelm√§√üige Backups", "Intrusion Detection Systeme"], m: "BEDROHUNGEN" },
    { q: "Handelt es sich bei APT-Gruppen grunds√§tzlich NUR um Bedrohungsakteure, die im Auftrag einer Regierung handeln?", a: "Nein, das ist falsch.", e: "Auch kriminelle Banden (z.B. Ransomware-Gruppen wie Conti) k√∂nnen APT-Methoden nutzen, auch wenn staatliche Akteure die Mehrheit bilden.", o: ["Ja, das ist die Definition.", "Nein, das ist falsch.", "Nur wenn sie aus Europa kommen.", "Ja, aber nur im Kriegsfall."], m: "BEDROHUNGEN" },
    { q: "Welche Technik wird oft von APT-Gruppen genutzt, um den Erstzugang zu einem Netzwerk zu erhalten?", a: "Spear-Phishing", e: "Der Faktor Mensch (E-Mail mit Anhang) ist nach wie vor das h√§ufigste Einfallstor f√ºr APTs.", o: ["DDoS-Angriffe", "Spear-Phishing", "Physischer Einbruch", "Brute-Force auf WLAN-Passw√∂rter"], m: "BEDROHUNGEN" },
    { q: "Welcher Punkt tr√§gt NICHT zur Schwierigkeit der Attribution (Zuweisung) von Cyberangriffen bei?", a: "Mangelhafte operative Sicherheitsma√ünahmen der Verteidiger.", e: "Die schlechte Sicherheit des Opfers macht den Angriff leichter, erschwert aber nicht die Frage, WER es war. False Flags oder Proxies hingegen schon.", o: ["Einsatz von False-Flag-Operationen.", "Nutzung von Standard-Malware.", "Mangelhafte operative Sicherheitsma√ünahmen der Verteidiger.", "Verschleierung √ºber Proxy-Server."], m: "BEDROHUNGEN" },
    { q: "Was ist ein wesentlicher Nachteil des Diamond Modells?", a: "Es ist schwer auf komplexe Bedrohungen anwendbar.", e: "Das Diamond Model ist gut f√ºr Einzelereignisse, bildet aber komplexe, mehrstufige Angriffsketten (wie in der Kill Chain) oft schlechter ab.", o: ["Es ben√∂tigt eine permanente Internetverbindung.", "Es ist schwer auf komplexe Bedrohungen anwendbar.", "Es ist nur f√ºr Phishing-Mails gedacht.", "Es wird vom BSI nicht mehr unterst√ºtzt."], m: "BEDROHUNGEN" },
    { q: "Ist die Steganographie ein Teilbereich der Kryptographie?", a: "Falsch", e: "Kryptographie verschl√ºsselt den Inhalt (macht ihn unlesbar). Steganographie versteckt die Existenz der Nachricht (z.B. in einem Bild).", o: ["Richtig", "Falsch", "Nur bei digitaler Steganographie", "Nur im Bereich VS-GEHEIM"], m: "KRYPTO" },
    { q: "Welchen Schl√ºssel nutzt Teilnehmer A bei der asymmetrischen Verschl√ºsselung, um Teilnehmer B eine vertrauliche Nachricht zu senden?", a: "Den √∂ffentlichen Schl√ºssel von B", e: "Verschl√ºsselt wird immer mit dem Public Key des Empf√§ngers. Entschl√ºsselt nur mit dessen Private Key.", o: ["Den eigenen privaten Schl√ºssel", "Den eigenen √∂ffentlichen Schl√ºssel", "Den privaten Schl√ºssel von B", "Den √∂ffentlichen Schl√ºssel von B"], m: "KRYPTO" },
    { q: "Aussage: Symmetrische Verschl√ºsselungsmechanismen (z. B. DES) sind grunds√§tzlich sicherer als asymmetrische Verschl√ºsselungen.", a: "Falsch", e: "Symmetrische Verfahren sind schneller, aber nicht pauschal sicherer. Die Sicherheit h√§ngt von der Schl√ºssell√§nge und dem Algorithmus ab.", o: ["Wahr", "Falsch", "Nur bei gro√üen Dateien wahr", "Gilt nur f√ºr das NATO-Netz"], m: "KRYPTO" },
    { q: "Worauf basiert die Sicherheit moderner asymmetrischer Kryptoverfahren?", a: "Auf der Geheimhaltung des privaten Schl√ºssels (Verfahren ist bekannt).", e: "Kerckhoffs‚Äô Prinzip: Die Sicherheit darf nicht von der Geheimhaltung des Algorithmus abh√§ngen, sondern nur vom Schl√ºssel.", o: ["Auf der Geheimhaltung des Verschl√ºsselungsverfahrens.", "Auf der L√§nge der Nachricht.", "Auf der Geheimhaltung des privaten Schl√ºssels (Verfahren ist bekannt).", "Auf der Geschwindigkeit der Hardware."], m: "KRYPTO" },
    { q: "Womit besch√§ftigt sich die Kryptoanalyse prim√§r?", a: "Dem Brechen von Kryptographieverfahren ohne Kenntnis des Schl√ºssels.", e: "Kryptoanalyse sucht mathematische Schw√§chen, um Verschl√ºsselungen zu knacken.", o: ["Dem Erstellen neuer Codes.", "Dem Brechen von Kryptographieverfahren ohne Kenntnis des Schl√ºssels.", "Der physischen Vernichtung von Krypto-Ger√§ten.", "Der Verwaltung von Passw√∂rtern."], m: "KRYPTO" },
    { q: "Wie viele Nationale Verteilungsorganisationen (NDA) gibt es f√ºr Kryptomaterial in Deutschland?", a: "Genau eine (Zentralisierung).", e: "Die Verteilung von Schl√ºsseln ist zentralisiert (NDA GE in Rheinbach), um die Lieferkette zu sichern.", o: ["Eine pro Teilstreitkraft.", "Genau eine (Zentralisierung).", "Vier (analog zu den ATZ).", "Sechzehn (eine pro Bundesland)."], m: "KRYPTO" },
    { q: "Wer tr√§gt die Gesamtverantwortung f√ºr das Kryptomaterial innerhalb einer Dienststelle?", a: "Der Dienststellenleiter (DStL).", e: "Wie bei der Informationssicherheit haftet der Leiter auch f√ºr die Sicherheit der Kryptomittel.", o: ["Der Kryptoverwalter (KryVw).", "Der Dienststellenleiter (DStL).", "Der S6-Offizier.", "Der Kryptobeauftragte (KryB)."], m: "KRYPTO" },
    { q: "Aussage: Die Bundeswehr nutzt f√ºr die operative √úbertragung von Daten √ºberwiegend asymmetrische Verschl√ºsselung.", a: "Falsch (√ºberwiegend symmetrisch wegen Performance/Sicherheit).", e: "F√ºr Massendaten (Funk, Richtfunk, WAN) werden schnelle symmetrische Verfahren genutzt. Asymmetrisch dient meist nur dem Schl√ºsselaustausch.", o: ["Wahr", "Falsch (√ºberwiegend symmetrisch wegen Performance/Sicherheit).", "Wahr, aber nur im Einsatzland.", "Wahr, au√üer bei Funkger√§ten."], m: "KRYPTO" },
    { q: "In welche Kategorie der Kryptomittel f√§llt eine SmartCard?", a: "Kryptounterlagen", e: "SmartCards (z.B. PersDat) gelten verwaltungstechnisch oft als Kryptounterlagen (oder Zubeh√∂r je nach Vorschrift), da sie Schl√ºssel enthalten.", o: ["Kryptoger√§te", "Kryptomaterial", "Kryptounterlagen", "IT-Peripherie"], m: "KRYPTO" },
    { q: "In welche Kategorie f√§llt ein Kryptodatentr√§ger (z. B. USB-Stick mit Schl√ºsseln)?", a: "Kryptounterlagen", e: "Datentr√§ger mit Schl√ºsseln werden wie Papierunterlagen verwaltet.", o: ["Kryptoger√§te", "Kryptounterlagen", "Hardware-Komponenten", "Kryptomaterial"], m: "KRYPTO" },
    { q: "Wie wird das Ger√§t ELCRODAT 4-2 kategorisiert?", a: "Kryptomaterial (Kryptoger√§t)", e: "Das ELCRODAT ist ein Hardware-Verschl√ºsselungsger√§t und damit ein CCI (Controlled Cryptographic Item).", o: ["Kryptounterlage", "Kryptomaterial (Kryptoger√§t)", "Zubeh√∂rteil", "Kryptovariable"], m: "KRYPTO" },
    { q: "Welcher Grundsatz gilt f√ºr Sonderkurier und Kurierbegleiter beim Betreten eines Flugzeugs?", a: "Als letzter einsteigen und als erster aussteigen.", e: "Dies dient der Sicherheit und √úbersicht, um Staus oder Trennung in der Menge zu vermeiden.", o: ["Zuerst einsteigen, um das Gep√§ck zu verstauen.", "Als letzter einsteigen und als erster aussteigen.", "Immer mit den Piloten einsteigen.", "Zusammen mit der Priority-Gruppe einsteigen."], m: "KRYPTO" },
    { q: "Darf das Kuriergep√§ck im Flugzeug von den Kurieren getrennt werden (z. B. im Frachtraum)?", a: "Nein, es muss unter st√§ndiger Aufsicht bleiben.", e: "VS und Kryptomittel d√ºrfen nie aus der pers√∂nlichen Kontrolle gegeben werden.", o: ["Ja, wenn es ein versiegelter Container ist.", "Ja, bei Fl√ºgen √ºber 4 Stunden.", "Nein, es muss unter st√§ndiger Aufsicht bleiben.", "Nur wenn der Kapit√§n es anordnet."], m: "KRYPTO" }
];

/* --- LOGIC: GLOBAL --- */
let activeSet = [];
let retryStack = [];
let currentIndex = 0;
let streak = 0;
let isExam = false;
let examAnswers = {};

function shuffle(arr) {
    for(let i=arr.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

/* --- LOGIC: TRAINER MODE --- */
function initTrainer(filter) {
    isExam = false;
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('trainer-screen').classList.remove('hidden');
    
    if(filter === 'ALL') activeSet = [...BANK];
    else activeSet = BANK.filter(x => x.m === filter);
    
    shuffle(activeSet);
    currentIndex = 0;
    streak = 0;
    retryStack = [];
    updateStreak();
    loadCard();
}

function loadCard() {
    if(currentIndex >= activeSet.length) {
        if(retryStack.length > 0) {
            alert(`Runde beendet. Jetzt ${retryStack.length} Fehler wiederholen!`);
            activeSet = [...retryStack];
            retryStack = [];
            currentIndex = 0;
            shuffle(activeSet);
        } else {
            alert("Training abgeschlossen! Alle Fragen gemeistert.");
            location.reload();
            return;
        }
    }
    
    const item = activeSet[currentIndex];
    document.getElementById('t-mod').innerText = item.m;
    document.getElementById('t-idx').innerText = `${currentIndex+1} / ${activeSet.length}`;
    document.getElementById('t-question').innerText = item.q;
    document.getElementById('t-retry-badge').classList.toggle('hidden', retryStack.includes(item)); // Simpel-Check
    document.getElementById('t-progress').style.width = `${(currentIndex/activeSet.length)*100}%`;
    
    // Optionen rendern
    const c = document.getElementById('t-options');
    c.innerHTML = '';
    document.getElementById('t-expl').style.display = 'none';
    
    let opts = item.o.map(o => ({ txt:o, isCorrect: o===item.a }));
    shuffle(opts);
    
    opts.forEach((o, i) => {
        const btn = document.createElement('div');
        btn.className = 'opt-btn';
        btn.innerHTML = `<div class="opt-key">${i+1}</div> <div>${o.txt}</div>`;
        btn.onclick = () => checkTrainerAnswer(btn, o.isCorrect, item);
        c.appendChild(btn);
    });
}

function checkTrainerAnswer(btn, isCorrect, item) {
    if(btn.parentElement.classList.contains('locked')) return;
    btn.parentElement.classList.add('locked'); // Sperren
    
    const explBox = document.getElementById('t-expl');
    const title = document.getElementById('t-expl-title');
    const text = document.getElementById('t-expl-text');
    
    explBox.style.display = 'block';
    explBox.className = 'expl-box ' + (isCorrect ? 'is-correct' : 'is-wrong');
    text.innerText = item.e;
    
    if(isCorrect) {
        btn.classList.add('correct');
        title.innerText = "‚úì Richtig!";
        streak++;
    } else {
        btn.classList.add('wrong');
        title.innerText = "‚úó Leider falsch.";
        streak = 0;
        retryStack.push(item);
        
        // Richtige Antwort zeigen
        Array.from(document.querySelectorAll('.opt-btn')).forEach(b => {
            if(b.innerText.includes(item.a)) b.classList.add('correct');
        });
    }
    updateStreak();
    
    // Hotkey Space listener aktivieren wir global
}

function nextCard() {
    const opts = document.getElementById('t-options');
    if(!opts.classList.contains('locked')) return; // Nur wenn geantwortet
    currentIndex++;
    opts.classList.remove('locked');
    loadCard();
}

function updateStreak() {
    document.getElementById('t-streak').innerText = streak;
}

/* --- LOGIC: EXAM MODE --- */
function initExam() {
    isExam = true;
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('exam-screen').classList.remove('hidden');
    
    // W√§hle 45 zuf√§llige
    let pool = [...BANK];
    shuffle(pool);
    activeSet = pool.slice(0, 45);
    examAnswers = {};
    
    const container = document.getElementById('exam-list');
    container.innerHTML = '';
    
    activeSet.forEach((item, idx) => {
        let opts = [...item.o];
        shuffle(opts);
        
        const div = document.createElement('div');
        div.className = 'exam-item';
        div.id = `exam-q-${idx}`;
        div.innerHTML = `
            <div class="q-meta">Frage ${idx+1}</div>
            <div class="exam-q">${item.q}</div>
            ${opts.map(o => `
                <label class="exam-opt">
                    <input type="radio" name="q${idx}" value="${o}" onchange="examAnswers[${idx}]='${o}'">
                    <span>${o}</span>
                </label>
            `).join('')}
            <div class="exam-expl">
                <strong>L√∂sung:</strong> ${item.a}<br>
                <div style="margin-top:5px; padding-left:10px; border-left:2px solid var(--accent);">${item.e}</div>
            </div>
        `;
        container.appendChild(div);
    });
}

function submitExam() {
    if(Object.keys(examAnswers).length < activeSet.length) {
        if(!confirm(`Du hast erst ${Object.keys(examAnswers).length} von ${activeSet.length} Fragen beantwortet. Wirklich abgeben?`)) return;
    }
    
    let score = 0;
    activeSet.forEach((item, idx) => {
        const userAns = examAnswers[idx];
        const div = document.getElementById(`exam-q-${idx}`);
        const inputs = div.querySelectorAll('input');
        
        inputs.forEach(inp => inp.disabled = true); // Sperren
        
        if(userAns === item.a) {
            score++;
            div.classList.add('graded-correct');
        } else {
            div.classList.add('graded-wrong');
        }
    });
    
    const perc = Math.round((score / activeSet.length) * 100);
    let grade = "Nicht bestanden";
    if(perc >= 90) grade = "Sehr gut";
    else if(perc >= 80) grade = "Gut";
    else if(perc >= 65) grade = "Bestanden";
    
    const header = document.getElementById('exam-result-header');
    header.innerHTML = `
        <div class="exam-score-box">
            <div style="font-size:3rem; font-weight:800; color:${perc >= 65 ? 'var(--success)' : 'var(--error)'}">${perc}%</div>
            <div style="font-size:1.2rem; margin-bottom:10px;">${score} von ${activeSet.length} Punkten</div>
            <div style="font-weight:bold; color:var(--muted)">${grade}</div>
        </div>
    `;
    header.classList.remove('hidden');
    document.getElementById('btn-submit-exam').style.display = 'none';
    
    window.scrollTo(0,0);
}

/* --- LOGIC: HOTKEYS & INIT --- */
document.addEventListener('keydown', (e) => {
    if(isExam) return; // Keine Hotkeys in Pr√ºfung
    if(document.getElementById('trainer-screen').classList.contains('hidden')) return;
    
    if(['1','2','3','4'].includes(e.key)) {
        const idx = parseInt(e.key) - 1;
        const btns = document.querySelectorAll('.opt-btn');
        if(btns[idx]) btns[idx].click();
    }
    if(e.code === 'Space') {
        e.preventDefault();
        nextCard();
    }
});

// Init Module Buttons
const modules = [...new Set(BANK.map(x=>x.m))];
const modContainer = document.getElementById('module-list');
modules.forEach(m => {
    const btn = document.createElement('div');
    btn.className = 'mode-card';
    btn.style.padding = '10px 15px';
    btn.style.marginBottom = '0';
    btn.innerHTML = `<span style="font-weight:bold; font-size:0.9rem;">${m}</span>`;
    btn.onclick = () => initTrainer(m);
    modContainer.appendChild(btn);
});

</script>
</body>
</html>
